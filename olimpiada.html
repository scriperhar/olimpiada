<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Олимпиада</title>
    <link href="https://germes-lift.ru/wp-content/uploads/kmz.png" rel="shortcut icon" type="image/ico" />
</head>
<body>
    <table align="center">
        <tr>
            <td>
                <h3>ОЛИМПИАДА</h3>
            </td>
        </tr>
    </table>
    <table align="center">
        <tr align="center">
            <td><button id="callbutton25" onclick="call(25)">25</button></td>
            <td><b id="A_25"></b> <b id="B_25"></b> <b id="C_25"></b></td>
            <td><button id="Ab_25" onclick="aim(A, 25)">25</button> <button id="Bb_25" onclick="aim(B, 25)">25</button> <button id="Cb_25" onclick="aim(C, 25)">25</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton24" onclick="call(24)">24</button></td>
            <td><b id="A_24"></b> <b id="B_24"></b> <b id="C_24"></b></td>
            <td><button id="Ab_24" onclick="aim(A, 24)">24</button> <button id="Bb_24" onclick="aim(B, 24)">24</button> <button id="Cb_24" onclick="aim(C, 24)">24</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton23" onclick="call(23)">23</button></td>
            <td><b id="A_23"></b> <b id="B_23"></b> <b id="C_23"></b></td>
            <td><button id="Ab_23" onclick="aim(A, 23)">23</button> <button id="Bb_23" onclick="aim(B, 23)">23</button> <button id="Cb_23" onclick="aim(C, 23)">23</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton22" onclick="call(22)">22</button></td>
            <td><b id="A_22"></b> <b id="B_22"></b> <b id="C_22"></b></td>
            <td><button id="Ab_22" onclick="aim(A, 22)">22</button> <button id="Bb_22" onclick="aim(B, 22)">22</button> <button id="Cb_22" onclick="aim(C, 22)">22</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton21" onclick="call(21)">21</button></td>
            <td><b id="A_21"></b> <b id="B_21"></b> <b id="C_21"></b></td>
            <td><button id="Ab_21" onclick="aim(A, 21)">21</button> <button id="Bb_21" onclick="aim(B, 21)">21</button> <button id="Cb_21" onclick="aim(C, 21)">21</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton20" onclick="call(20)">20</button></td>
            <td><b id="A_20"></b> <b id="B_20"></b> <b id="C_20"></b></td>
            <td><button id="Ab_20" onclick="aim(A, 20)">20</button> <button id="Bb_20" onclick="aim(B, 20)">20</button> <button id="Cb_20" onclick="aim(C, 20)">20</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton19" onclick="call(19)">19</button></td>
            <td><b id="A_19"></b> <b id="B_19"></b> <b id="C_19"></b></td>
            <td><button id="Ab_19" onclick="aim(A, 19)">19</button> <button id="Bb_19" onclick="aim(B, 19)">19</button> <button id="Cb_19" onclick="aim(C, 19)">19</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton18" onclick="call(18)">18</button></td>
            <td><b id="A_18"></b> <b id="B_18"></b> <b id="C_18"></b></td>
            <td><button id="Ab_18" onclick="aim(A, 18)">18</button> <button id="Bb_18" onclick="aim(B, 18)">18</button> <button id="Cb_18" onclick="aim(C, 18)">18</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton17" onclick="call(17)">17</button></td>
            <td><b id="A_17"></b> <b id="B_17"></b> <b id="C_17"></b></td>
            <td><button id="Ab_17" onclick="aim(A, 17)">17</button> <button id="Bb_17" onclick="aim(B, 17)">17</button> <button id="Cb_17" onclick="aim(C, 17)">17</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton16" onclick="call(16)">16</button></td>
            <td><b id="A_16"></b> <b id="B_16"></b> <b id="C_16"></b></td>
            <td><button id="Ab_16" onclick="aim(A, 16)">16</button> <button id="Bb_16" onclick="aim(B, 16)">16</button> <button id="Cb_16" onclick="aim(C, 16)">16</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton15" onclick="call(15)">15</button></td>
            <td><b id="A_15"></b> <b id="B_15"></b> <b id="C_15"></b></td>
            <td><button id="Ab_15" onclick="aim(A, 15)">15</button> <button id="Bb_15" onclick="aim(B, 15)">15</button> <button id="Cb_15" onclick="aim(C, 15)">15</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton14" onclick="call(14)">14</button></td>
            <td><b id="A_14"></b> <b id="B_14"></b> <b id="C_14"></b></td>
            <td><button id="Ab_14" onclick="aim(A, 14)">14</button> <button id="Bb_14" onclick="aim(B, 14)">14</button> <button id="Cb_14" onclick="aim(C, 14)">14</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton13" onclick="call(13)">13</button></td>
            <td><b id="A_13"></b> <b id="B_13"></b> <b id="C_13"></b></td>
            <td><button id="Ab_13" onclick="aim(A, 13)">13</button> <button id="Bb_13" onclick="aim(B, 13)">13</button> <button id="Cb_13" onclick="aim(C, 13)">13</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton12" onclick="call(12)">12</button></td>
            <td><b id="A_12"></b> <b id="B_12"></b> <b id="C_12"></b></td>
            <td><button id="Ab_12" onclick="aim(A, 12)">12</button> <button id="Bb_12" onclick="aim(B, 12)">12</button> <button id="Cb_12" onclick="aim(C, 12)">12</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton11" onclick="call(11)">11</button></td>
            <td><b id="A_11"></b> <b id="B_11"></b> <b id="C_11"></b></td>
            <td><button id="Ab_11" onclick="aim(A, 11)">11</button> <button id="Bb_11" onclick="aim(B, 11)">11</button> <button id="Cb_11" onclick="aim(C, 11)">11</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton10" onclick="call(10)">10</button></td>
            <td><b id="A_10"></b> <b id="B_10"></b> <b id="C_10"></b></td>
            <td><button id="Ab_10" onclick="aim(A, 10)">10</button> <button id="Bb_10" onclick="aim(B, 10)">10</button> <button id="Cb_10" onclick="aim(C, 10)">10</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton9" onclick="call(9)">9</button></td>
            <td><b id="A_9"></b> <b id="B_9"></b> <b id="C_9"></b></td>
            <td><button id="Ab_9" onclick="aim(A, 9)">9</button> <button id="Bb_9" onclick="aim(B, 9)">9</button> <button id="Cb_9" onclick="aim(C, 9)">9</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton8" onclick="call(8)">8</button></td>
            <td><b id="A_8"></b> <b id="B_8"></b> <b id="C_8"></b></td>
            <td><button id="Ab_8" onclick="aim(A, 8)">8</button> <button id="Bb_8" onclick="aim(B, 8)">8</button> <button id="Cb_8" onclick="aim(C, 8)">8</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton7" onclick="call(7)">7</button></td>
            <td><b id="A_7"></b> <b id="B_7"></b> <b id="C_7"></b></td>
            <td><button id="Ab_7" onclick="aim(A, 7)">7</button> <button id="Bb_7" onclick="aim(B, 7)">7</button> <button id="Cb_7" onclick="aim(C, 7)">7</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton6" onclick="call(6)">6</button></td>
            <td><b id="A_6"></b> <b id="B_6"></b> <b id="C_6"></b></td>
            <td><button id="Ab_6" onclick="aim(A, 6)">6</button> <button id="Bb_6" onclick="aim(B, 6)">6</button> <button id="Cb_6" onclick="aim(C, 6)">6</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton5" onclick="call(5)">5</button></td>
            <td><b id="A_5"></b> <b id="B_5"></b> <b id="C_5"></b></td>
            <td><button id="Ab_5" onclick="aim(A, 5)">5</button> <button id="Bb_5" onclick="aim(B, 5)">5</button> <button id="Cb_5" onclick="aim(C, 5)">5</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton4" onclick="call(4)">4</button></td>
            <td><b id="A_4"></b> <b id="B_4"></b> <b id="C_4"></b></td>
            <td><button id="Ab_4" onclick="aim(A, 4)">4</button> <button id="Bb_4" onclick="aim(B, 4)">4</button> <button id="Cb_4" onclick="aim(C, 4)">4</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton3" onclick="call(3)">3</button></td>
            <td><b id="A_3"></b> <b id="B_3"></b> <b id="C_3"></b></td>
            <td><button id="Ab_3" onclick="aim(A, 3)">3</button> <button id="Bb_3" onclick="aim(B, 3)">3</button> <button id="Cb_3" onclick="aim(C, 3)">3</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton2" onclick="call(2)">2</button></td>
            <td><b id="A_2"></b> <b id="B_2"></b> <b id="C_2"></b></td>
            <td><button id="Ab_2" onclick="aim(A, 2)">2</button> <button id="Bb_2" onclick="aim(B, 2)">2</button> <button id="Cb_2" onclick="aim(C, 2)">2</button></td>
        </tr>
        <tr align="center">
            <td><button id="callbutton1" onclick="call(1)">1</button></td>
            <td><b id="A_1"></b> <b id="B_1"></b> <b id="C_1"></b></td>
            <td><button id="Ab_1" onclick="aim(A, 1)">1</button> <button id="Bb_1" onclick="aim(B, 1)">1</button> <button id="Cb_1" onclick="aim(C, 1)">1</button></td>
        </tr>
    </table>
</body>
</html>
<script type="text/javascript">
    function sleep(ms) {
        return new Promise(resolve => {
            setTimeout(resolve, ms);
        });
    }
    const status = ["..", "][", "[]"];

    class Elevator {
        constructor(floor, speed, name, doors_status, doors_open_time, moving) {
            this.floor = floor;
            this.speed = speed;
            this.name = name;
            this.doors_status = doors_status;
            this.doors_open_time = doors_open_time;
            this.moving = moving;
        }
    }

    var A = new Elevator(1, 0.5, "A", 0, 2, 0);
    var B = new Elevator(12, 0.5, "B", 0, 2, 0);
    var C = new Elevator(25, 0.5, "C", 0, 2, 0);

    function update(lift_moved) {
        for (let i = 1; i <= 25; i++) {
            var element = document.getElementById(lift_moved.name + "_" + i.toString());
            if (i === lift_moved.floor) {
                element.innerHTML = status[1];
            } else {
                element.innerHTML = status[0];
            }
        }
    }
    update(A);
    update(B);
    update(C);

    async function doors(lift, floor) {
        document.getElementById(lift.name + "_" + floor).innerHTML = status[2]
        await sleep(lift.doors_open_time * 1000);
        document.getElementById(lift.name + "_" + floor).innerHTML = status[1]
    }

    async function move(lift, aim_floor) {
        while (lift.moving === 1) {
            await sleep(1000)
        }
        lift.moving = 1;
        if (aim_floor > lift.floor) {
            while (lift.floor != aim_floor) {
                lift.floor += 1;
                update(lift)
                await sleep(lift.speed * 1000);
            }
        } else if (aim_floor < lift.floor) {
            while (lift.floor != aim_floor) {
                lift.floor -= 1;
                update(lift)
                await sleep(lift.speed * 1000);
            }
        }
        await doors(lift, aim_floor);
        lift.moving = 0;
        return "moved"
    }

    async function call(call_floor) {
        document.getElementById("callbutton" + call_floor.toString()).style = "background-color: green";

        A_diff = Math.abs(call_floor - A.floor);
        B_diff = Math.abs(call_floor - B.floor);
        C_diff = Math.abs(call_floor - C.floor);

        if (call_floor === A.floor) {
            await doors(A, call_floor)
        } else if (call_floor === B.floor) {
            await doors(B, call_floor)
        } else if (call_floor === C.floor) {
            await doors(C, call_floor)
        }
        else if (A_diff < B_diff && A_diff < C_diff) {
            await move(A, call_floor)
        } else if (B_diff < A_diff && B_diff < C_diff) {
            await move(B, call_floor)
        } else if (C_diff < A_diff && C_diff < B_diff) {
            await move(C, call_floor)
        }
        else if (A_diff === B_diff || A_diff === C_diff) {
            await move(A, call_floor)
        } else if (B_diff === C_diff) {
            await move(B, call_floor)
        }

        document.getElementById("callbutton" + call_floor.toString()).style = "background-color: light-gray";
    }

    async function aim(lift, aim_floor) {
        document.getElementById(lift.name + "b_" + aim_floor.toString()).style = "background-color: green";
        await move(lift, aim_floor)
        document.getElementById(lift.name + "b_" + aim_floor.toString()).style = "background-color: light-gray";
    }
</script>